<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>Content Card</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="HTML is the foundation of the World Wide Web, and it is still the most popular markup language in use today.">
	<meta name="view-transition" content="same-origin">
	<!-- <link rel="stylesheet" href="/base.css"> -->
	<link rel="stylesheet" href="/ui/layout/dist/layout.min.css" blocking="render">
	<link rel="stylesheet" href="index.css" blocking="render">

	<!-- <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"> -->

	<style>
		/*
		content-card {
	font-family: var(--cc-ff,  Avenir, Montserrat, Corbel, 'URW Gothic', source-sans-pro, sans-serif);
}
		font-family: var(--c-headline-ff, Didot, 'Bodoni MT', 'Noto Serif Display', 'URW Palladio L', P052, Sylfaen, serif);
		*/
	html {
		interpolate-size: allow-keywords;
		--layout-primary-bg: hsl(220, 20%, 95%);
		--layout-primary-c: hsl(220, 100%, 20%);
		--layout-secondary-bg: hsl(120, 50%, 95%);
		--layout-secondary-c: hsl(120, 50%, 20%);
		/* --layout-tertiary-c: hsl(30, 10%, 95%); */
		--layout-tertiary-bg: #FFE7E0;
	}
	body {
		--layout-bleed-mw: 1024px;
		--layout-mi: 1rem;
		display: grid;
		margin-block: 1rem;
		margin-inline: max(var(--layout-mi), 50cqw - var(--layout-bleed-mw) / 2);
		row-gap: 1rem;
	}
		
		main {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
			gap: 1rem;
			padding: 1rem;
		}

		.primary {  --cc-bg: var(--layout-primary-bg); }
		.secondary { --cc-bg: var(--layout-secondary-bg); }

		content-card[type=spot] { --cc-bdrs: .5rem; }
		lay-out[overflow] { --layout-scrollbar-c: #0002 #0000; }
		.material-symbols-outlined { font-display: auto; }
/* 
		.ic-ribbon--live {
			background-color: #c00;
			color: white;
		}

		.ic-ribbon--popular {
			background-color: #007bff;
			color: white;
		} */
	</style>
</head>
<body>

	<lay-out lg="grid(3c)" col-gap="2" row-gap="2" gap>
		<content-card content="news-11" layout="rows(th-1 21:9 p:1 flip)"></content-card>
		<content-card content="news-2"></content-card>
		<content-card content="news-3" layout="rows(th-2 p:1)"></content-card>
	</lay-out>

	<lay-out lg="columns(1)" bleed col-gap="2" pad-bottom="2" pad-inline="1" pad-top="2" theme="secondary">
		<content-card content="news-4" layout="columns(21:9)" col-gap="2"></content-card>
	</lay-out>

	<content-card content="news-6" layout="columns(21:9 th-2 p:1.5)"></content-card>
	<content-card content="news-7" layout="columns(21:9 th-2 p:1.5 flip)"></content-card>

	<lay-out lg="columns(4)" pad-top="2" pad-bottom="2">
		<content-card content="spot-1" layout="stack(b-c ta-c p:1 3:4 ovl)"></content-card>
		<content-card content="spot-2" layout="stack(c-l ta-c p:1 3:4 ovl)"></content-card>
		<content-card content="spot-3" layout="stack(b-r ta-c p:1 3:4 ovl)"></content-card>
		<content-card content="spot-4" layout="stack(t-c ta-c p:1 3:4 ovl)"></content-card>
	</lay-out>

	<lay-out bleed pad-bottom="2" pad-inline="1" pad-top="2" theme="tertiary">
		<content-card content="news-1" layout="stack(c-l th-2 p:1 w:50)"></content-card>
	</lay-out>

	<lay-out lg="columns(3)" col-gap="2" row-gap="2" gap pad-bottom="2" pad-top="2" subgrid="5">
		<content-card content="news-5"></content-card>
		<content-card content="news-9"></content-card>
		<content-card content="news-13"></content-card>
	</lay-out>

	<content-card content="news-12" layout="p:1.5" class="secondary"></content-card>

	<lay-out md="columns(2)" lg="ratio(66:33)" bleed theme="primary" pad-top="2" pad-bottom="2" col-gap="4">
		<lay-out lg="bento(4a)">
			<content-card content="spot-1" layout="stack(b-c ta-c p:1 1:1 ovl)"></content-card>
			<content-card content="spot-2" layout="stack(t-l ta-c p:1 1:1 ovl)"></content-card>
			<content-card content="spot-3" layout="stack(b-r ta-c p:1 1:1 ovl)"></content-card>
			<content-card content="spot-4" layout="stack(t-c ta-c p:1 1:1 ovl)"></content-card>
		</lay-out>
		<lay-out gap self="start" row-gap="2">
			<content-card content="news-5"></content-card>
			<content-card content="news-9"></content-card>
		</lay-out>
	</lay-out>

	<lay-out md="columns(2)" lg="columns(4)" overflow="preview" pad-top="2" pad-bottom="2">
		<content-card content="product-1"></content-card>
		<content-card content="product-2"></content-card>
		<content-card content="product-3"></content-card>
		<content-card content="product-4"></content-card>
		<content-card content="product-5"></content-card>
		<content-card content="product-6"></content-card>
		<content-card content="product-7"></content-card>
		<content-card content="product-8"></content-card>
	</lay-out>

	<lay-out md="columns(2)" bleed col-gap="2" pad-top="3" pad-bottom="2" row-gap="2" theme="tertiary">
		<content-card content="recipe-3"></content-card>
		<content-card content="recipe-1" layout=""></content-card>
		<content-card content="recipe-2"></content-card>
		<content-card content="recipe-4"></content-card>
	</lay-out>
	

	<main></main>

	<script type="module">
		// Import layout srcsets utilities
		import { generateLayoutSrcsets, createLayoutsDataMap } from '../layout/index.js';

		// Load layout data once and initialize everything
		async function initializeApp() {
			try {
				console.log('üîß Loading layout configuration...');
				
				// Load configuration and layout data once
				const [config, gridData, columnsData, bentoData, asymmetricalData, ratiosData] = await Promise.all([
					fetch('../layout/config.json').then(r => r.json()),
					fetch('../layout/systems/layouts/grid.json').then(r => r.json()),
					fetch('../layout/systems/layouts/columns.json').then(r => r.json()),
					fetch('../layout/systems/layouts/bento.json').then(r => r.json()),
					fetch('../layout/systems/layouts/asymmetrical.json').then(r => r.json()),
					fetch('../layout/systems/layouts/ratios.json').then(r => r.json())
				]);

				// Store globally for reuse
				window._layoutSrcsetData = {
					config,
					layoutsData: createLayoutsDataMap({
						'grid.json': gridData,
						'columns.json': columnsData,
						'bento.json': bentoData,
						'asymmetrical.json': asymmetricalData,
						'ratios.json': ratiosData
					})
				};

				// 1. First, set srcsets on all lay-out elements
				console.log('üìê Setting layout srcsets...');
				const layoutElements = document.querySelectorAll('lay-out');
				console.log(`üìä Found ${layoutElements.length} lay-out elements`);

				let processedCount = 0;
				layoutElements.forEach((element, index) => {
					try {
						const srcsets = generateLayoutSrcsets(element, config, window._layoutSrcsetData.layoutsData);
						
						if (srcsets && srcsets !== 'default:100vw') {
							element.setAttribute('srcsets', srcsets);
							console.log(`‚úÖ Set srcsets for lay-out ${index + 1}:`, srcsets);
							processedCount++;
						} else {
							// For lay-out elements without responsive breakpoints, set a basic fallback
							element.setAttribute('srcsets', 'default:100vw');
							console.log(`‚ÑπÔ∏è  Set fallback srcsets for lay-out ${index + 1} (no breakpoint layouts)`);
							processedCount++;
						}
					} catch (error) {
						console.warn(`‚ö†Ô∏è  Failed to generate srcsets for lay-out ${index + 1}:`, error);
						// Still set basic fallback on error
						element.setAttribute('srcsets', 'default:100vw');
					}
				});

				console.log(`üìà Successfully processed ${processedCount}/${layoutElements.length} lay-out elements`);
				console.log('üéâ Layout srcsets complete!');

				// 2. Now load and initialize content-card custom element
				console.log('üÉè Loading content-card component...');
				await import('./index.js');
				
				// 3. Initialize content cards (layout srcsets are ready)
				console.log('üÉè Initializing content cards...');
				await initializeContentCards();

			} catch (error) {
				console.error('‚ùå Failed to initialize app:', error);
			}
		}

		// Utility function for dynamic content
		window.updateLayoutSrcsets = function(container = document) {
			if (!window._layoutSrcsetData) {
				console.warn('‚ö†Ô∏è  Layout data not loaded yet');
				return;
			}

			const newLayoutElements = container.querySelectorAll('lay-out:not([srcsets])');
			if (newLayoutElements.length > 0) {
				console.log(`üîÑ Updating srcsets for ${newLayoutElements.length} new lay-out elements`);
				
				newLayoutElements.forEach((element, index) => {
					try {
						const srcsets = generateLayoutSrcsets(element, window._layoutSrcsetData.config, window._layoutSrcsetData.layoutsData);
						if (srcsets && srcsets !== 'default:100vw') {
							element.setAttribute('srcsets', srcsets);
							console.log(`‚úÖ Updated srcsets for new lay-out ${index + 1}:`, srcsets);
						}
					} catch (error) {
						console.warn(`‚ö†Ô∏è  Failed to update srcsets for new lay-out ${index + 1}:`, error);
					}
				});
			}
		};

		// Content card initialization function
		async function initializeContentCards() {
			await customElements.whenDefined('content-card');
			const main = document.querySelector('main');
			const news = await fetch('data.json').then(r => r.json());
			
			// Collect all statically defined content-card[content] elements
			const definedContent = new Set(
				Array.from(document.querySelectorAll('content-card[content]'))
					.map(el => el.getAttribute('content'))
			);

			news.forEach(item => {
				if (definedContent.has(item.id)) return;
				const card = document.createElement('content-card');
				card.dataset = { data: item };
				card.setAttribute('type', item.type);
				main.appendChild(card);
			});

			console.log('üÉè Content cards initialized!');
		}

		// Start the app
		initializeApp();
	</script>

	<!--
<script type="module">
		customElements.whenDefined('one-block').then(async () => {
			const block = document.getElementById('content-12345');
			const data = await fetch('full.json').then(r => r.json());
			
			const settings = {
				type: "article",
				styles: {
					'ob-content': "shadow-md rounded-lg p-6 border border-gray-200",
					'ob-tagline': "text-xs font-semibold tracking-wide uppercase text-blue-600",
					'ob-headline': "text-2xl font-bold text-gray-900 mt-2 mb-3",
					'ob-summary': "text-gray-700 mb-4",
					'ob-authors': "text-sm text-gray-500 mt-4",
					'ob-author': "font-medium text-gray-800",
					'ob-avatar': "w-8 h-8 rounded-full mr-2 inline-block",
					'ob-tags': "mt-4 flex flex-wrap gap-2",
					'ob-tag': "text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-2 py-1 rounded-full",
					'ob-actions': "mt-5 flex gap-3",
					'ob-action-primary': "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded", // Prefixed key
					'ob-action-secondary': "bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded", // Prefixed key
					'ob-action-icon': "inline-block mr-1" // Prefixed key
					// Add more prefixed part names and Tailwind classes as needed
				}
			};

			block.dataset = { data, settings };
		});
	</script>

	-->
</body>
</html>