@import url('/ui/icon/ui-icon.css');
@layer bs-component {
	:where(.ui-data-entry) {
		--_bdc: var(--ButtonBorder);
		--_bdrs: var(--input-bdrs);
		--_bdw: var(--input-bdw);
		--_pb: .6ch;
		--_pi: 1.2ch;

		display: grid;
		& *:not(ui-icon) { font-size: 1rem; }

		details + details { margin-block-start: 1ch; }

		fieldset {
			border: 0;
			gap: 0;
			padding: 0;
			legend { font-weight: 700; }
		}
		
		:is(input:not([type=checkbox],[type=radio]), select, textarea) {
			block-size: 100%;
			border: 0;
			border-radius: 0;
			font-family: inherit;
			padding-block: var(--_pb);
			padding-inline: var(--_pi);
			&::-webkit-inner-spin-button{ display: none; }
		}

		label, summary { /* row */
			align-items: center;
			border-block-width: 0 var(--_bdw);
			border-inline-width: var(--_bdw);
			border-color: var(--_bdc);
			border-style: solid;
			display: grid;
			grid-template-columns: 125px 1fr;
			user-select: none;

			&:first-of-type {
				border-block-start-width: var(--_bdw);
				border-start-start-radius: var(--_bdrs);
				border-start-end-radius: var(--_bdrs);
				& > *:first-child { border-start-start-radius: var(--_bdrs); }
				& > *:last-child { border-start-end-radius: calc(var(--_bdrs) - var(--_bdw)); }
			}
			&:last-of-type {
				border-end-start-radius: var(--_bdrs);
				border-end-end-radius: var(--_bdrs);
				& > *:first-child { border-end-start-radius: var(--_bdrs); }
				& > *:last-child { border-end-end-radius: calc(var(--_bdrs) - var(--_bdw)); }
			}
			&:is(summary) {
				em { padding-inline: var(--_pi); }
				[open] & {
					border-block-end-width: 0;;
					border-end-start-radius: 0;
					border-end-end-radius: 0;
					& + fieldset label:first-of-type {
						border-start-start-radius: 0;
						border-start-end-radius: 0;
					}
				}
				&::-webkit-details-marker { display: none; }
			}

			span {
				border-inline-end: var(--_bdw) solid var(--_bdc);
			}
		}

		nav {
			display: flex;
			gap: 1ch;
			justify-content: end;
		}

		span {
			align-items: center;
			background-color: var(--CanvasGray);
			column-gap: 1ch;
			display: flex;
			font-weight: 500;
			height: 100%;
			padding: var(--_pb) var(--_pi);
			width: 100%;
		}

		textarea {
			field-sizing: content;
			min-block-size: 2.4lh;
			resize: vertical;
		}

		[popovertarget] {
			anchor-name: var(--_an);
		}

		[popover] {
			border: var(--_bdw) solid var(--_bdc);
			border-radius: var(--_bdrs);
			inset-block: anchor(bottom) auto;
			inset-inline: auto anchor(right);
			min-inline-size: 20rem;
			padding: 2ch;
			position-anchor: var(--_pa);
			text-wrap: nowrap;
			&::backdrop { background: light-dark(#0002, #000A); }
			[dir=rtl] & { inset-inline: auto anchor(left); }
			nav { margin-block-start: 1ch; }
		}

		/* Focus */
		:is(button, input:not([type=checkbox], [type=radio]), select, summary, textarea):focus-visible,
		input[type=date]:focus-within,
		label:has([type=checkbox], [type=radio]):focus-within {
			background-color: var(--ButtonFace);
			outline: 2px solid var(--AccentColor);
			outline-offset: -1px;
			& * { outline: none; }
		}
		label:has([type=checkbox], [type=radio]):focus-within + label {
			clip-path: inset(2px 0 0 0);
		}

		/* TODO! Browser bug: Chrome date/datetime-fields not working with right-to-left */
		
		/* === Checklist === */
		[part=checklist] {
			em {
				align-items: center;
				display: flex;
				font-weight: 400;
				justify-content: space-between;
				margin-inline-end: 1ch;
				text-wrap: nowrap;
			}
			label:has(input:not(:checked)) {
				background: color-mix(in srgb, var(--ColorError), var(--Canvas) 80%);
				color: var(--GrayText);
				text-decoration: line-through;
				input { 
					background-color: var(--ColorError);
					--input-check-bdc: var(--ColorError); 
					--input-check-bga: #FFF; 
				}
			}
		}

		/* === Grid === */
		[part=grid] {
			@media (max-width: 599px) {
				fieldset:not(:last-of-type) {
					margin-block-end: 1lh;
				}
			}

			@media (min-width: 600px) {
				& {
					background: var(--_bdc);
					margin-block-start: 1lh;
					padding: var(--_bdw);
					position: relative;
					row-gap: var(--_bdw);
				}

				& > legend {
					inset-block-start: -1lh;
					position: absolute;
				}

				label {
					border: 0;
					grid-template-columns: unset;
					row-gap: var(--_bdw); 
					span { border: 0; }
					&:last-of-type *:first-child {
						border-end-start-radius: 0;
						border-start-end-radius: var(--_bdrs);
					}
				 }

				fieldset {
					column-gap: var(--_bdw);
					grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
					&:nth-of-type(n+2) label > span { display: none; } /* Only show the labels from firtst row */
					& :is(input, select, textarea) { --icon: none; }
					&:not(:last-of-type) label {
						& > *:last-child { border-radius: 0; }	
					}
					&:last-of-type label:first-of-type > *:last-child {
						border-end-start-radius: var(--_bdrs);
						border-start-end-radius: 0;
					}
				}
			}
		}

		/* === Micro Button === */
		[part=micro] {
			background: #0000;
			color: var(--LinkText);
			font-size: x-small;
			margin-block-start: .5lh;
			padding: 0;
		}

		[part=rowgap] {
			margin-block-end: 1lh;
		}
	}
}