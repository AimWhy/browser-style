<html lang="en-US" dir="ltr">
	<!DOCTYPE html>
<head>
	<title>UI</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="HTML is the foundation of the World Wide Web, and it is still the most popular markup language in use today.">

</head>
<body class="bg-orange-700 md:bg-zinc-400 lg:bg-sky-400">
	<h1>Utility</h1>

	<h2>Component</h2>
	<button class="bg-green-800 c-white-100 pi-2 pb-0.5 rounded">Click Me</button>
	<div id="app"></div>

	<script type="module">
		import { applyStylesheet, generateClasses } from './utility.js';

const color = (selectedNames, colorArray = colors) => {
    const filteredColors = selectedNames
        ? colorArray.filter(({ name }) => selectedNames.includes(name))
        : colorArray;

    return { type: 'color', values: filteredColors.map(({ name, values }) => ({ name, values: values.split(' ') })) };
};
const scale = ({ unit = 'rem', values = [0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 16, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 64, 72, 80, 96] } = {}) => ({ unit, type: 'length', values });

const aspectRatio = [
	{ name: 'auto', value: 'auto' },
	{ name: '1:1', value: '1/1' },
	{ name: '16:9', value: '16/9' }
]
const breakpoints = [
	{ key: 'sm', value: 360 },
	{ key: 'md', value: 768 },
	{ key: 'lg', value: 1024 },
	{ key: 'xl', value: 1280 },
	{ key: 'xxl', value: 1536 },
]
const colors = [
	{ name: 'slate', values: '#f1f5f9 #e2e8f0 #cbd5e1 #94a3b8 #64748b #475569 #334155 #1e293b #0f172a #020617' },
	{ name: 'gray', values: '#f3f4f6 #e5e7eb #d1d5db #9ca3af #6b7280 #4b5563 #374155 #1f2937 #111827 #030712' },
	{ name: 'zinc', values: '#f4f4f5 #e4e4e7 #d4d4d8 #a1a1aa #71717a #52525b #3f3f46 #27272a #18181b #090b0b' },
	{ name: 'neutral', values: '#f5f5f5 #e5e5e5 #d4d4d4 #a3a3a3 #737373 #525252 #404040 #262626 #171717 #0a0a0a' },
	{ name: 'stone', values: '#f5f5f4 #e7e5e4 #d6d3d1 #a8a29e #78716c #57534e #443c3c #292525 #1c1917 #0c0a09' },
	{ name: 'red', values: '#fee2e2 #fecccc #fca5a5 #f87171 #ef4444 #dc2626 #b91919 #991b1b #7f1d1d #450a0a' },
	{ name: 'orange', values: '#ffedd5 #fed7aa #fdba74 #fb923c #f97316 #ea580c #c2410c #9a3412 #7c2d12 #431407' },
	{ name: 'amber', values: '#fef3c7 #fde68a #fcd34d #fbbf24 #f59e0b #d97706 #b45309 #92400e #78350f #451a03' },
	{ name: 'yellow', values: '#fef9c3 #fef088 #fde047 #fac415 #eab308 #ca8a04 #a16207 #854d0e #713f12 #422006' },
	{ name: 'lime', values: '#ecfccb #d9f99d #bee664 #a3e635 #84cc16 #65a30d #4d7c0f #3f6214 #365314 #1a2e05' },
	{ name: 'green', values: '#dcfce7 #bbf7d0 #86efac #4ade80 #22c55e #16a34a #118f3e #156c36 #14532d #052e16' },
	{ name: 'emerald', values: '#d1fae5 #a7f3d0 #6ee7b7 #34d399 #10b981 #059669 #047857 #065f46 #064e3b #022c22' },
	{ name: 'teal', values: '#ccfbf1 #99f6e4 #5eead4 #2dd4bf #14b8a6 #0d947f #0e7267 #117a6b #133c3a #042f2e' },
	{ name: 'cyan', values: '#cffafe #a5f3fc #67e8f9 #22d3ee #06b6d4 #0891b2 #0e7490 #156778 #164e63 #083344' },
	{ name: 'sky', values: '#e0f2fe #bae6fd #7dd3fc #38bdf8 #0ea5e9 #0284c7 #0369a1 #075985 #0c4a6e #082f4e' },
	{ name: 'blue', values: '#dbeaff #bfc7fc #93c5fd #60a5fa #3c82eb #2563eb #1d4ed8 #1e40af #1e3a8a #172554' },
	{ name: 'indigo', values: '#e0e7ff #c7d2fe #a5b4fc #8190f7 #6376f1 #4f46e5 #4130e3 #2b2b45 #2b2c59 #1e1e43' },
	{ name: 'violet', values: '#ede9fe #ddd6fe #c4b5fd #a787fa #8b5cf6 #7c3aed #6d28d9 #5b21b6 #4d1d9e #2e1b4b' },
	{ name: 'purple', values: '#f3e8ff #e9d5ff #d8b4fe #c084fc #a855f7 #9333ea #7d21cc #6b1d99 #581d75 #3b065e' },
	{ name: 'fuchsia', values: '#fadeff #f5d0fe #f0abfc #e879f9 #d953a7 #c52770 #a61b56 #862539 #701c49 #4a0433' },
	{ name: 'pink', values: '#fce7f3 #fbcee8 #f9a8d4 #f472b6 #ec4899 #db2777 #be185d #9f1239 #832029 #500724' },
	{ name: 'rose', values: '#ffe4e6 #fed1d3 #fda4af #fb71a9 #ec4879 #e12948 #be122b #9d1226 #88191e #4c0519' },
]
const fontFamily = [
	{ name: 'sans', value: 'ui-sans-serif, system-ui, sans-serif' },
	{ name: 'serif', value: 'ui-serif, serif' },
	{ name: 'mono', value: 'ui-monospace, monospace' }
];
const fontSizes = [
	{ name: 'xs', value: '0.75rem' },
	{ name: 'sm', value: '0.875rem' },
	{ name: 'md', value: '1rem' },
	{ name: 'lg', value: '1.125rem' },
	{ name: 'xl', value: '1.25rem' },
	{ name: '2xl', value: '1.5rem' },
	{ name: '3xl', value: '1.875rem' },
	{ name: '4xl', value: '2.25rem' },
	{ name: '5xl', value: '3rem' },
	{ name: '6xl', value: '3.75rem' },
	{ name: '7xl', value: '4.5rem' },
	{ name: '8xl', value: '6rem' },
	{ name: '9xl', value: '8rem' }
]

const styles = [
	{ property: 'aspect-ratio', prefix: 'asr', type: 'buttongroup', values: aspectRatio, breakpoints: [], group: 'aspect-ratio' },
	{ property: 'background-color', prefix: 'bg', ...color(['stone', 'red', 'amber', 'green', 'sky']), breakpoints: ['sm','lg'], group: 'backgrounds' },
	
	/* spacing */
	{ property: 'margin', prefix: 'm', ...scale(), breakpoints: [], group: 'margin' },
	{ property: 'margin-block', prefix: 'mb', ...scale(), breakpoints: ['sm', 'lg'], group: 'margin' },
	{ property: 'margin-inline', prefix: 'mi', ...scale(), breakpoints: [], group: 'margin' },
	{ property: 'padding', prefix: 'p', ...scale(), breakpoints: [], group: 'padding' },
	{ property: 'padding-block', prefix: 'pb', ...scale(), breakpoints: [], group: 'padding' },
	{ property: 'padding-inline', prefix: 'pi', ...scale(), breakpoints: [], group: 'padding' },

	/* sizing */
	{ property: 'height', prefix: 'h', ...scale({ unit: 'em' }), breakpoints: [], group: 'sizing' },
	{ property: 'max-height', prefix: 'max-h', ...scale(), breakpoints: [], group: 'sizing'},
	{ property: 'max-width', prefix: 'max-w', ...scale(), breakpoints: [], group: 'sizing'},
	{ property: 'min-height', prefix: 'min-h', ...scale(), breakpoints: [], group: 'sizing'},
	{ property: 'min-width', prefix: 'min-w', ...scale(), breakpoints: [], group: 'sizing'},
	{ property: 'width', prefix: 'w', ...scale(), breakpoints: [], group: 'sizing'},

	/* typography */
	{ property: 'font-family', prefix: 'ff', type: 'string', values: fontFamily, breakpoints: ['lg'], group: 'fontfamily' },
	{ property: 'font-size', prefix: 'fs', type: 'buttongroup', values: fontSizes, breakpoints: ['lg'], group: 'fontsize' },
];

const groups = [
	{
		"key": "styles",
		"groups": [
			{
				key: 'layout',
				label: 'Layout',
				name: 'style-utility',
				part: 'style-part-layout',
				groups: [
					{
						key: 'aspect-ratio',
						label: 'Aspect Ratio',
						name: 'layout',
						fieldsets: [
							{
								part: 'buttongroup',
								fields: []
							}
						]
					}
				]
			},
			{
				key: 'flexgrid',
				label: 'Flexbox & Grid',
				name: 'style-utility',
				part: 'style-part-flexgrid',
			},
			{
				key: 'spacing',
				label: 'Spacing',
				name: 'style-utility',
				part: 'style-part-spacing',
				groups: [
					{
						key: 'padding',
						label: 'Padding',
						name: 'spacing',
						fieldsets: [
							{
								fields: []
							}
						]
					},
					{
						key: 'margin',
						label: 'Margin',
						name: 'spacing',
						fieldsets: [
						{
							fields: []
						}
						]
					},
				]
			},
			{
				key: 'sizing',
				label: 'Sizing',
				name: 'style-utility',
				part: 'style-part-sizing',
			},
			{
				key: 'typography',
				label: 'Typography',
				name: 'style-utility',
				part: 'style-part-typography',
				groups: [
					{
						key: 'fontfamily',
						label: 'Font Family',
						name: 'typography',
						fieldsets: [
							{
								part: 'radio font',
								fields: []
							},
						]
					},
					{
						key: 'fontsize',
						label: 'Font Size',
						name: 'typography',
						fieldsets: [
							{
								part: 'buttongroup',
								fields: []
							},
						]
					}
				]
			},
			{
				key: 'backgrounds',
				label: 'Backgrounds',
				name: 'style-utility',
				part: 'style-part-backgrounds',
				fieldsets: [
					{
						part: "radio colorgrid",
						fields: []
					}
				]
			},
			{
				key: 'borders',
				label: 'Borders',
				name: 'style-utility',
				fieldsets: []
			},
			{
				key: 'effects',
				label: 'Effects',
				name: 'style-utility',
			}
		]
	}
];



// const generatedClasses = generateClasses(styles, breakpoints);
// applyStylesheet(generatedClasses);
// console.log(generatedClasses);

function generateJSON(styles, groups) {
	const json = [...groups];
	styles.forEach(style => {
		const group = findObjectByProperty(json, 'key', style.group);
		if (group) {
			if (!group.fieldsets) group.fieldsets = [];
			if (!group.fieldsets.length) {
				group.fieldsets.push({ name: style.group, fields: [] });
			}
			switch (style.type) {
				case 'buttongroup': 
					group.fieldsets[0].fields = renderString(style, true);
					break;
				case 'length': 
					group.fieldsets[0].fields.push(renderRange(style));
					break;
				case 'color':
					group.fieldsets[0].fields = renderColor(style);
					break;
				case 'string':
					group.fieldsets[0].fields = renderString(style);
					break;
			}
		}
	});

	return json;
}

function renderColor(style) {
	return style.values.flatMap(({ name, values }) => {
		return values.map((color, index) => {
			const checkColor = contrast(color);
			return {
				// obj: {
					// ui: 'input',
					textAfter: `${name}-${(index+1)*100}`,
					input: {
						'data-breakpoints': style.breakpoints,
						'data-prefix': style.prefix,
						style: `--_v:${color};--_c:${checkColor};`,
						name: style.prefix,
						type: 'radio',
						value: `${name}-${(index+1)*100}`
					},
				}
			// };
		});
	});
}

function renderRange(style) {
	const label = toTitleCase(style.property);
	return { 
		// obj: {
		// ui: 'input',
		text: label,
		input: {
			'data-breakpoints': style.breakpoints,
			'data-prefix': style.prefix,
			...(style.values ? { 'data-values': style.values } : null),
			name: style.prefix,
			type: 'range',
			value: 0
		},
	// }
};
}

function renderString(style, isButtonGroup = false) {
	return style.values.map(({ name, value }) => {
		return {
			// obj: {
				// ui: 'input',
				textAfter: name,
				input: {
					'data-breakpoints': style.breakpoints,
					'data-prefix': style.prefix,
					...(isButtonGroup ? { 'data-sr': '' } : null),
					name: style.prefix,
					type: 'radio',
					value: name
				},
				label: {
					style: `--_v:${value}`,
				}
			// }
		};
	});
}
function hexToRgb(hex) {
    hex = hex.replace(/^#/, '');
    const bigint = parseInt(hex, 16);
    const r = (bigint >> 16) & 255;
    const g = (bigint >> 8) & 255;
    const b = bigint & 255;
    return { r, g, b };
}

function contrast(color) {
	const { r, g, b } = hexToRgb(color);
	const brightness = (299 * r + 587 * g + 114 * b) / 1000;
	return brightness <= 127 ? '#FFF' : '#000';
}

function toTitleCase(inputString) {
	return inputString
		.split('-')
		.map(word => word.charAt(0).toUpperCase() + word.slice(1))
		.join(' ');
}

function filterEmptyFieldsets(groups) {
	return groups
		.filter(group => {
			if (group.fieldsets && group.fieldsets.length === 0) {
				return false;
			}
			if (group.groups) {
				group.groups = filterEmptyFieldsets(group.groups);
			}

			return true;
		})
	.filter(group => group.fieldsets || (group.groups && group.groups.length > 0));
}

const output = generateJSON(styles, groups);
const filteredOutput = filterEmptyFieldsets(output);

console.log(JSON.stringify(filteredOutput, null, 2));



// console.log(generateJSON(styles, groups))

// const style = app.style;
// const regex = /([a-z]+)|([A-Z][a-z]*)/g;
// const unique = new Set();
// const result = Object.keys(style).map(key => {
// 	const parts = [];
// 	let match;
// 	while ((match = regex.exec(key)) !== null) {
// 		parts.push(match[0].toLocaleLowerCase());
// 	}

// 	let prefix = parts.map(part => part.charAt(0).toLowerCase()).join("");

// 	return {
// 		property: parts.join("-"),
// 		prefix
// 	};
// });

// console.log(result);

function findObjectByProperty(data, propertyName, propertyValue) {
	if (typeof data !== "object" || data === null) {
		return null; // Handle non-object or null data
	}

	if (data[propertyName] === propertyValue) {
		return data; // Base case: match found in current object
	}

	if (Array.isArray(data)) {
		for (const item of data) {
			const result = findObjectByProperty(item, propertyName, propertyValue); // Recursive call on each item
			if (result) {
				return result;
			}
		}
	} else if (typeof data === "object") {
		for (const key in data) {
			const value = data[key];
			const result = findObjectByProperty(value, propertyName, propertyValue); // Recursive call on each value
			if (result) {
				return result;
			}
		}
	}

	return null; // Not found
}
	</script>
</body>
</html>