<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>AutoSuggest</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="HTML is the foundation of the World Wide Web, and it is still the most popular markup language in use today.">
	<meta name="view-transition" content="same-origin">
	<link rel="stylesheet" href="/base.css">

	<style>
		ul[part="list"] {
			block-size: 10rem;
			border: var(--input-bdw) solid var(--ButtonBorder);
			inset-block: anchor(bottom);
			inset-inline: anchor(start);
			margin: 0;
			overflow-y: scroll;
			padding: 0;
			width: anchor-size(width);
			li {
				padding: calc(var(--input-pb) / 2) var(--input-pi);
				&:focus-visible {
					background-color: var(--CanvasGray);
					outline-offset: -1px;
				}
				@media (hover: hover) {
					&:hover {
						background-color: var(--CanvasGray);
						cursor: pointer;
					}
				}
			}
		}
	</style>
</head>
<body>
	<h1>UI: Components</h1>

	<h2>AutoSuggest</h2>
	<p>AutoSuggest is a Web Component, wrapping an <code>input</code> and a <code>datalist</code>. It exposes several events.</p>

	<auto-suggest
		api="https://dawa.aws.dk/adresser/autocomplete?side=1&per_side=10&q="
		api-value-path="adresse.id"
		api-display-path="tekst"
		id="dawa"
		label="Dawa search"
		list-mode="ul">
	</auto-suggest>

	<br>
	<auto-suggest
		api="https://jsonplaceholder.typicode.com/albums/?_limit=10&q="
		api-value-path="id"
		api-display-path="title"
		label="JSON placeholder">
	</auto-suggest>

	<br>
	<auto-suggest
		api="https://api.nationalize.io/?name="
		api-array-path="country"
		api-value-path="country_id"
		api-display-path="country_id"
		id="nationalize"
		label="Nationalize.io">
	</auto-suggest>
	
	<script type="module">
		import { AutoSuggest } from './index.js';
		AutoSuggest.mount();
	</script>

	<script>
		const suggest = document.querySelectorAll('auto-suggest');
		suggest.forEach((node) => {
			['autoSuggestClear', 'autoSuggestFetchStart', 'autoSuggestFetchEnd', 'autoSuggestFetchError', 'autoSuggestNoResults', 'autoSuggestSelect'].forEach((event) => {
				node.addEventListener(event, (event) => {
					console.log(event.type, event.detail ? event.detail : '');
				});
			});
		});

		document.addEventListener('DOMContentLoaded', () => {
			// const dawa = document.getElementById('dawa');
			// dawa.render = (data) => {
			// 	return data.map(obj => 
			// 		`<li tabindex="0" data-value="${obj.tekst}" data-key="${obj.adresse.id}">
			// 				<img src='http://unsplash.it/100/100?random&gravity=center' alt=''>${obj.tekst}
			// 			</li>`
			// 	).join('');
			// };

			const nationalize = document.getElementById('nationalize');
			nationalize.render = (data) => {
				return data.map(obj => 
					`<option value="${nationalize.input.value} â€” Country: ${obj.country_id}, Probability: ${(obj.probability * 100).toFixed(2)}%" data-key="${obj.country_id}"></option>`
				).join('');
			};
		});
	</script>
</body>
</html>