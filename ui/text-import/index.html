<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
  <title>Text Import</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="HTML is the foundation of the World Wide Web, and it is still the most popular markup language in use today.">
  <meta name="view-transition" content="same-origin">
  <link rel="stylesheet" href="/base.css">	
</head>
<body>
  <h1>UI: Components</h1>

  <h2>Import Text</h2>
  <p>
		Convert a TSV or CSV file to JSON using a user-defined mapping.
  </p>


	<text-import required label="Select file" accept=".txt,.csv" styles></text-import>
	<script type="module" src="./index.js"></script>

	<script>
		customElements.whenDefined('text-import').then(() => {
			const textImport = document.querySelector('text-import');
			
			 // Merge the new isbn formatter with existing formatters
			textImport.formatters = {
				isbn: str => {
					if (!str) return null;
					const cleaned = str.replace(/\D/g, '');
					if (cleaned.length >= 13) {
						return cleaned.slice(0, 13);
					}
					return cleaned;
				}
			};

			textImport.customMapping = [
				{ source: 'STOCK_NO', target: 'sku' },
				{ source: 'EAN_NO', target: 'barcode', formatter: 'isbn' },
				{ source: 'FULL_TITLE', target: 'name', formatter: 'titleCase' },
				{ source: 'ISSUE_NO', target: 'issue', type: 'int' },
				{ source: 'PRICE', target: 'price', type: 'float' },
				{ source: 'SHIP_DATE', target: 'release_date', type: 'date' },
				{ source: 'MAIN_DESC', target: 'description|0', prefix: '', suffix: '.' },
				{ source: 'PAGE', target: 'description|3', prefix: 'Page in catalog: ', suffix: '.' },
				{ source: 'WRITER', target: 'description|1', prefix: 'Writer: ', suffix: '.' },
				{ source: 'ARTIST', target: 'description|2', prefix: 'Artist: ', suffix: '.' }
			];
		});
	</script>
</body>
</html>
