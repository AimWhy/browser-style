<!DOCTYPE html>
<html lang="en-US" dir="ltr">
	<head>
		<title>Mega Menu</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
		<meta name="description" content="Sun Phase">
		<meta name="view-transition" content="same-origin">
		<link rel="stylesheet" href="index.css">
		<link rel="stylesheet" href="demo.css">
		<style>
			body {
				font-family: system-ui, sans-serif;
				margin: 0 max(1rem, 50cqw - 900px / 2);
				padding: 0;
			}
			h1 { font-weight: 300; }
			p { font-size: 150%; line-height: 1.6;}
		</style>
	</head>
	<body>

		<mega-menu bleed>

			<!-- data-menu="skip": Accessibility skip link that's hidden off-screen but appears when focused -->
			<a href="#main" data-menu="skip">Skip to main content</a>

			<!-- data-menu="menubar": Main container that holds brand (logo), trigger for mobile navigation, and navigation -->
			<header data-menu="menubar">
				<a href="/">BRAND</a>
				<!-- data-menu="trigger": Mobile menu toggle button with hidden checkbox for state management -->
				<label aria-label="Open menu" data-menu="trigger">
					<input type="checkbox">
					â˜°
				</label>

				<!-- data-menu="view": Viewport container that slides in on mobile and contains navigation on desktop -->
				<div data-menu="view">
					<!-- data-menu="nav": Navigation container that flexes horizontally on desktop -->
					<nav aria-label="Main navigation" data-menu="nav">
						<!-- data-menu="topic": Top-level menu items that contain dropdown content -->
						<details data-menu="topic" name="main-menu">
							<summary>Products</summary>
							<!-- data-menu="content": Dropdown content area that appears below menu items -->
							<div data-menu="content">
								<!-- data-menu="section": Sub-sections within dropdown content that can be nested -->
								<details data-menu="section">
									<summary>Smartphones</summary>
									<div role="group">
										<a href="/products/smartphones/iphone">iPhone</a>
										<a href="/products/smartphones/android">Android</a>
										<a href="/products/smartphones/pixel">Google Pixel</a>
										<a href="/products/smartphones/samsung">Samsung Galaxy</a>
									</div>
								</details>

								<details data-menu="section">
									<summary>Laptops</summary>
									<div role="group">
										<a href="/products/laptops/macbook">MacBook</a>
										<a href="/products/laptops/surface">Surface</a>
										<a href="/products/laptops/thinkpad">ThinkPad</a>
										<a href="/products/laptops/chromebook">Chromebook</a>
									</div>
								</details>

								<details data-menu="section">
									<summary>Tablets</summary>
									<div role="group">
										<a href="/products/tablets/ipad">iPad</a>
										<a href="/products/tablets/surface-pro">Surface Pro</a>
										<a href="/products/tablets/galaxy-tab">Galaxy Tab</a>
									</div>
								</details>

								<details data-menu="section">
									<summary>Audio</summary>
									<div role="group">
										<a href="/products/accessories/audio/headphones">Headphones</a>
										<a href="/products/accessories/audio/earbuds">Earbuds</a>
										<a href="/products/accessories/audio/speakers">Speakers</a>
									</div>
								</details>

								<details data-menu="section">
									<summary>Charging</summary>
									<div role="group">
										<a href="/products/accessories/charging/cables">Cables</a>
										<a href="/products/accessories/charging/wireless">Wireless Chargers</a>
										<a href="/products/accessories/charging/power-banks">Power Banks</a>
									</div>
								</details>

								<details data-menu="section">
									<summary>Cases & Protection</summary>
									<div role="group">
										<a href="/products/accessories/cases/phone-cases">Phone Cases</a>
										<a href="/products/accessories/cases/laptop-bags">Laptop Bags</a>
										<a href="/products/accessories/cases/screen-protectors">Screen Protectors</a>
									</div>
								</details>
							</div>
						</details>

						<details data-menu="topic" name="main-menu">
							<summary>Services</summary>
							<div data-menu="content">
								<details data-menu="section">
									<summary>Support</summary>
									<div role="group">
										<a href="/services/support/technical">Technical Support</a>
										<a href="/services/support/warranty">Warranty</a>
										<a href="/services/support/repairs">Repairs</a>
									</div>
								</details>

								<details data-menu="section">
									<summary>Business</summary>
									<div role="group">
										<a href="/services/business/enterprise">Enterprise Solutions</a>
										<a href="/services/business/bulk-orders">Bulk Orders</a>
										<a href="/services/business/consultation">Consultation</a>
									</div>
								</details>
							</div>
						</details>

						<details data-menu="topic" name="main-menu">
							<summary>About</summary>
							<div data-menu="content">
								<a href="/about/company">Company</a>
								<a href="/about/careers">Careers</a>
								<a href="/about/news">News</a>
								<a href="/about/contact">Contact</a>
							</div>
						</details>
					</nav>

					<nav data-menu="nav">
						<details
							data-menu="topic"
							name="main-menu"
						>
							<summary>Search</summary>
							<search data-menu="content">
								<input type="text" placeholder="Search..." role="searchbox">
								<button type="submit">Search</button>
							</search>
						</details>
						<a href="">Help</a>
					</nav>
				</div>
			</header>
		</mega-menu>

		<!-- Main content -->

		<main id="main">
			<h1>Welcome to Our Website</h1>
			<p>
				This is the main content area. Click on the menu items to explore more.
			</p>
			<p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Dicta fugit voluptatem provident non quos architecto et in enim soluta, praesentium possimus quam animi sint ipsam odio nobis commodi nisi consequuntur accusantium. Asperiores error pariatur consequuntur vero maiores dolorum sit dignissimos numquam velit eaque tenetur laboriosam obcaecati earum aliquam iure necessitatibus, corrupti mollitia amet sapiente, totam debitis. Dolore voluptate commodi temporibus ducimus quod officiis explicabo autem nihil. Fugiat rem accusamus possimus ratione at? Eius, accusamus. Voluptatum adipisci facilis reprehenderit fugit aliquid officiis non ab rem aperiam, provident, rerum tempora quos corrupti eaque dolorum esse asperiores. Sit obcaecati eum officia nulla odit, ipsam recusandae quisquam quos fugiat a explicabo, in harum voluptate tempora ipsa animi deserunt atque facilis dignissimos blanditiis quo laboriosam nihil. Porro molestias, architecto cumque quidem iure quae nihil veniam nobis consectetur soluta aperiam recusandae nisi vero magni alias explicabo incidunt expedita accusamus rerum? Qui illum vero, quas excepturi animi harum, vitae quos esse magni beatae molestias recusandae sapiente fuga? Doloribus, dolores. Natus, consectetur porro delectus, soluta reprehenderit deserunt doloremque nulla voluptatem explicabo facere in dicta commodi sapiente sed dignissimos ullam laborum consequuntur totam aut tempora fugit ratione. Quaerat, reiciendis recusandae. Quia in eum sed, laboriosam dolorem commodi? Sed beatae ea quod! Commodi ipsa excepturi molestias delectus quisquam fuga cupiditate a, dicta quasi sint iure necessitatibus ipsum distinctio provident eius impedit debitis atque tempora adipisci sapiente voluptas totam maxime. Esse unde labore quia corrupti cum distinctio libero quisquam doloribus similique quas quaerat obcaecati voluptate iusto aspernatur sunt enim asperiores, alias ipsum culpa quod! Amet, omnis tempore cupiditate ex reprehenderit molestias voluptatibus aliquid voluptatem hic, laborum dolores mollitia labore? Eius doloribus ipsa nostrum alias nemo suscipit asperiores provident beatae magni animi rem tempore cum numquam tenetur omnis molestias nobis, architecto autem vitae unde, saepe accusamus voluptates? Unde accusantium mollitia autem cum! Nisi, saepe praesentium quaerat ipsa facere quos asperiores doloremque provident dolorem voluptatum nostrum ab aperiam eum veritatis eveniet molestiae necessitatibus exercitationem ut quam dolor distinctio illo officiis! Ea, non dicta facere odio itaque, suscipit sequi corporis totam ullam beatae pariatur quaerat reiciendis autem distinctio. Voluptatibus consectetur rerum ipsam ad sunt maiores ut illum, suscipit aperiam. Sint incidunt repudiandae provident nisi ipsam quam distinctio culpa, doloremque explicabo nemo porro nihil fugiat reprehenderit aut nostrum autem eligendi, eius neque illum, error voluptas? Dolores aspernatur quasi blanditiis perspiciatis facilis doloribus tenetur minima omnis quos ipsum unde non sint, autem delectus id ut hic. Quaerat, tempore, incidunt temporibus minima ipsum nisi totam dignissimos, doloribus voluptate obcaecati labore veniam aliquid maiores nihil sint harum nemo. Ut harum distinctio nulla, non aspernatur quis consectetur eaque provident dicta delectus consequatur beatae! Soluta quam aut praesentium corrupti atque vero debitis eligendi odit repellat nulla, perferendis excepturi culpa quod! Doloremque velit sapiente quas adipisci dolores eum nobis eaque sunt! In quis nisi aut accusantium, architecto soluta! Cum iste cumque odio aliquam totam repellendus voluptatum sed laborum facilis, voluptas officia minima quasi nostrum non alias reprehenderit natus repudiandae, architecto quibusdam veniam corporis mollitia incidunt asperiores. Delectus voluptatem ipsum, accusamus in animi corrupti? Exercitationem saepe deleniti quidem magni voluptas sapiente itaque reiciendis dolorem laboriosam autem nam illo, nesciunt nemo facilis, nostrum inventore quae labore hic? Hic, accusamus odit delectus in commodi qui quae esse, laudantium sequi blanditiis quidem voluptate numquam distinctio ab suscipit accusantium necessitatibus! Facere dolor voluptatibus, distinctio repudiandae libero et, blanditiis dolorum ad deserunt recusandae quaerat quae culpa! Veritatis pariatur possimus, nesciunt nemo cum illo reprehenderit illum ipsam. Magni, nisi aliquam earum debitis animi iusto sapiente corporis quam vel. At, possimus. Dicta sunt corporis minima tenetur, cumque sit doloribus totam soluta ducimus vel numquam odit labore nobis sint officia veniam, ratione voluptatem magni recusandae at! Excepturi doloremque, voluptas in eligendi dolores, ea similique pariatur quasi maxime veritatis ratione sed repellat quas neque itaque aliquid laborum magni exercitationem aut assumenda? Explicabo, dolor hic non tenetur impedit quasi. Quis asperiores nesciunt explicabo deleniti officiis facilis quasi nam consequuntur culpa sunt distinctio nostrum quam, sint praesentium rerum nulla commodi sequi eligendi assumenda? Itaque possimus minus ut quasi a obcaecati mollitia sint placeat fugit, animi alias accusantium nostrum nisi magni ipsum suscipit amet ratione corrupti quam et ducimus ad est. Consequatur, fugit placeat reiciendis molestiae eaque iusto sed explicabo vero! Consequatur exercitationem, doloremque quo veniam et quos? Exercitationem quibusdam quae, aliquid rerum labore, cupiditate magni molestiae repellendus minus vitae enim reprehenderit eius. Fuga necessitatibus quam dolor nisi hic dolore ad recusandae suscipit sint corrupti ab similique eligendi exercitationem mollitia amet in laboriosam explicabo assumenda facilis molestiae, omnis voluptas sapiente vitae. Dolorem, reprehenderit sapiente sunt, id ad eos autem officiis pariatur saepe, consectetur dignissimos quas dolor sint quam fugit. Commodi, enim ducimus quis illo, deserunt dolor architecto velit perferendis saepe omnis sit tenetur expedita quod quo voluptatem! Cum non velit voluptatum! Delectus voluptas veniam incidunt sequi ut ratione facere vel possimus ipsum eum saepe numquam consequatur animi repellendus, similique recusandae a tempora velit explicabo aut molestiae eius voluptatibus at quisquam. Autem temporibus perferendis iusto cumque itaque corporis. Quod explicabo voluptas magni officiis libero nulla! Omnis hic quod at delectus. Provident in velit, veritatis dignissimos fugiat vitae amet, nihil, quidem commodi dolor rerum impedit minus unde tempora maxime quod facere tenetur. Facere itaque rerum veritatis non quidem commodi obcaecati. Repellendus debitis quos reprehenderit cumque error atque quaerat ab voluptatem magnam porro consequatur veniam modi iure obcaecati sed, explicabo fuga libero ipsum odit assumenda laudantium necessitatibus eligendi. Totam molestiae rem libero nam? Ex est quasi dolore eligendi facere enim distinctio minima magni ratione eum corporis quisquam, modi facilis expedita similique culpa fuga ipsa excepturi iste accusantium optio sapiente! Itaque minus temporibus deserunt molestias! Accusantium, reiciendis, eius et quam nihil id ex fuga illum aliquid ipsam esse doloremque distinctio, optio debitis at repudiandae! Maxime cum nisi suscipit. Voluptatum, in omnis odio adipisci modi velit minima atque fuga doloribus dolores eaque libero quis? Doloribus quis exercitationem vitae quam aliquid nemo? Quae excepturi consequuntur ab incidunt! Veritatis veniam perferendis impedit? Reiciendis fugit quos quas nemo. Eligendi at voluptatem quis quo, similique explicabo et accusantium libero aut ipsa qui perspiciatis.</p>
		</main>

		<!-- https://www.w3.org/WAI/ARIA/apg/patterns/menubar/ -->
		<script>
			function setupMenuA11y(header, groupSel, panelSel, focusSel) {
				if (!header) return;
				let current = null;
				const clearAttrs = (el) => (
					el.removeAttribute('data-last-typed-char'),
					el.removeAttribute('data-last-typed-index')
				);
				const getElements = (panel) =>
					Array.from(panel.querySelectorAll(focusSel)).filter(
						(el) => el.offsetParent
					);
				const closePanel = (details = current) => {
					if (details) {
						details.open = false;
						details.querySelector('summary')?.focus();
					}
				};
				const focusInPanel = (panel, isLast = false) => {
					const elements = getElements(panel);
					if (elements.length) {
						const target = isLast ? elements[elements.length - 1] : elements[0];
						setTimeout(() => target.focus(), 10);
					}
				};

				const handleKey = (evt) => {
					if (!current?.open) return;
					const panel = current.querySelector(panelSel);
					if (!panel) return;

					const elements = getElements(panel);
					const len = elements.length;

					if (evt.key === 'Escape' || evt.key === 'Tab') {
						closePanel();
						if (evt.key === 'Escape') evt.preventDefault();
						return;
					} else if (
						(evt.key === 'ArrowLeft' || evt.key === 'ArrowRight') &&
						len
					) {
						evt.preventDefault();
						const idx = elements.indexOf(document.activeElement);
						const next =
							evt.key === 'ArrowRight'
								? (idx + 1) % len
								: (idx - 1 + len) % len;
						elements[next].focus();
					} else if ((evt.key === 'Home' || evt.key === 'End') && len) {
						evt.preventDefault();
						elements[evt.key === 'Home' ? 0 : len - 1].focus();
					} else if (
						/^[a-z0-9]$/i.test(evt.key) &&
						!evt.ctrlKey &&
						!evt.altKey &&
						!evt.metaKey
					) {
						evt.preventDefault();
						const char = evt.key.toLowerCase();
						const getText = (el) =>
							(
								el.getAttribute('aria-label') ||
								el.textContent ||
								el.innerText ||
								el.value ||
								el.placeholder ||
								''
							)
								.trim()
								.toLowerCase();
						const matches = elements.filter((el) =>
							getText(el).startsWith(char)
						);

						if (!matches.length) return;

						const { lastTypedChar: last, lastTypedIndex: lastIdx } =
							current.dataset;
						const nextIdx =
							last === char ? ((+lastIdx || 0) + 1) % matches.length : 0;

						matches[nextIdx].focus();
						current.dataset.lastTypedChar = char;
						current.dataset.lastTypedIndex = nextIdx;
					}
				};

				const handleClick = (evt) =>
					current && !header.contains(evt.target) && closePanel();

				const handleMenubarKey = (evt) => {
					if (evt.target.tagName !== 'SUMMARY' || !evt.target.closest(groupSel))
						return;
					if (evt.key === 'ArrowDown' || evt.key === 'ArrowUp') {
						evt.preventDefault();
						const details = evt.target.closest(groupSel);
						details.open = true;
						const panel = details.querySelector(panelSel);
						panel &&
							setTimeout(() => focusInPanel(panel, evt.key === 'ArrowUp'), 10);
					}
				};

				header.addEventListener('keydown', handleMenubarKey);

				header.addEventListener(
					'toggle',
					(evt) => {
						const details = evt.target;
						if (!details.matches(groupSel)) return;

						if (details.open) {
							header
								.querySelectorAll(groupSel)
								.forEach(
									(other) =>
										other !== details &&
										other.open &&
										((other.open = false), clearAttrs(other))
								);
							current = details;
							clearAttrs(current);
							document.addEventListener('keydown', handleKey, true);
							document.addEventListener('click', handleClick, true);

							const panel = details.querySelector(panelSel);
							panel && focusInPanel(panel);
						} else if (current === details) {
							document.removeEventListener('keydown', handleKey, true);
							document.removeEventListener('click', handleClick, true);
							clearAttrs(details);
							current = null;
						}
					},
					true
				);
			}

			document.addEventListener('DOMContentLoaded', () => {
				setupMenuA11y(
					document.querySelector('mega-menu'),
					'nav[data-menu="nav"] > details[data-menu="topic"]',
					'[data-menu="content"]',
					'a[href]:not([disabled]), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
				);
			});
		</script>
	</body>
</html>
