<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
	<title>Mega Menu</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
	<meta name="description" content="Sun Phase">
	<meta name="view-transition" content="same-origin">
	<!-- <link rel="stylesheet" href="/base.css"> -->

	<style>
		body {
			font-family: system-ui, sans-serif;
			margin: 0;
			padding: 0;
		}
	:root {
		container-type: inline-size;
		interpolate-size: allow-keywords;
	}

	main {
		background: tomato;
	}

	body {
		--layout-bleed-mw: 85ch;
		--layout-mi: 1rem;
		--mega-menu-mi: var(--layout-mi);
		--mega-menu-bleed-mw: var(--layout-bleed-mw);

		margin-inline: max(var(--layout-mi, 0), 50cqw - var(--layout-bleed-mw, 100cqw) / 2);
	}

[data-menu="header"] {
	background: #CCC;
	padding-block: 1ch;
}
[data-menu="container"] {
	background: #FFF;
}
[data-menu="panel"] {
	--mega-menu-desktop-panel-mih: 15rem;
	background: #F0F0F0;
}

/* === MEGA MENU COMPONENT === */
@layer components.mega-menu {
	[data-menu="header"] {
		* { box-sizing: border-box; }
		align-content: var(--mega-menu-ac, center);
		display: flex;
		justify-content: var(--mega-menu-jc, space-between);
		margin-inline: min(-1 * var(--mega-menu-mi, 0), var(--mega-menu-bleed-mw, 100vw) / 2 - 50vw);
		padding-inline: max(var(--mega-menu-mi, 0), calc((100vw - var(--mega-menu-bleed-mw, 100vw)) / 2));
		position: relative;
		user-select: none;

		[data-menu="container"] {
			height: 100svh;
			inset: 0 calc(100vw - var(--mega-menu-container-w, 80vw)) 0 0;
			width: var(--mega-menu-container-w, 80vw);
			position: var(--mega-menu-container-pos, fixed);
			transition: translate var(--mega-menu-container-trsdu, .2s) var(--mega-menu-container-trstf, cubic-bezier(.4, 0, .2, 1));
			translate: -100vw 0;
		}

		:is([data-menu="group"],[data-menu="section"]) summary { list-style: none; }
		&:has(#mega-menu-trigger:checked) [data-menu="container"] { translate: 0; }

		@media (min-width: 720px) {
			[data-menu="container"] { display: contents; }
			[data-menu="panel"] {
				columns: var(--mega-menu-desktop-panel-colm, 2);
				inset: 100% auto auto 0;
				min-height: var(--mega-menu-desktop-panel-mih, initial);
				padding-block: var(--mega-menu-desktop-panel-pb, 1lh);
				padding-inline: max(var(--mega-menu-panel-pi, var(--mega-menu-mi, 0)), calc((100vw - var(--mega-menu-bleed-mw, 100vw)) / 2));
				position: absolute;
				width: 100vw;
				details[data-menu="section"]::details-content {
					content-visibility: visible;
				}
			}
			[data-menu="primary"], [data-menu="secondary"], [data-menu="utility"] {
				column-gap: var(--mega-menu-nav-cg, 2ch);
				display: flex;
				flex-direction: row;
			}
			[data-menu="trigger"] { display: none; }
		}
	}
}

</style>
	</head>
	<body>
		<!-- https://www.w3.org/WAI/ARIA/apg/patterns/menubar/ -->
		<!-- <h1>UI: Components</h1>

		<h2>Mega Menu</h2> -->

		<header data-menu="header">
			<a href="/">LOGO</a>
			<label aria-label="Open menu" data-menu="trigger" for="mega-menu-trigger">
				<input type="checkbox" data-sr id="mega-menu-trigger">
				Menu
			</label>
			<div data-menu="container">
				<label aria-label="Close menu" data-menu="trigger" for="mega-menu-trigger">
					Close
				</label>
				<nav aria-label="Main navigation" data-menu="primary" role="menubar">
					<details data-menu="group" name="main-menu">
						<summary aria-haspopup="true">Products</summary>
						<div data-menu="panel" role="menu">
							<details data-menu="section">
								<summary aria-haspopup="true">Smartphones</summary>
								<div data-menu="links" role="group">
									<a href="/products/smartphones/iphone" role="menuitem">iPhone</a>
									<a href="/products/smartphones/android" role="menuitem">Android</a>
									<a href="/products/smartphones/pixel" role="menuitem">Google Pixel</a>
									<a href="/products/smartphones/samsung" role="menuitem">Samsung Galaxy</a>
								</div>
							</details>
							
							<details data-menu="section">
								<summary aria-haspopup="true">Laptops</summary>
								<div data-menu="links" role="group">
									<a href="/products/laptops/macbook" role="menuitem">MacBook</a>
									<a href="/products/laptops/surface" role="menuitem">Surface</a>
									<a href="/products/laptops/thinkpad" role="menuitem">ThinkPad</a>
									<a href="/products/laptops/chromebook" role="menuitem">Chromebook</a>
								</div>
							</details>
							
							<details data-menu="section">
								<summary aria-haspopup="true">Tablets</summary>
								<div data-menu="links" role="group">
									<a href="/products/tablets/ipad" role="menuitem">iPad</a>
									<a href="/products/tablets/surface-pro" role="menuitem">Surface Pro</a>
									<a href="/products/tablets/galaxy-tab" role="menuitem">Galaxy Tab</a>
								</div>
							</details>
							
							<details data-menu="section">
								<summary aria-haspopup="true">Accessories</summary>
								<div data-menu="group" role="group">
									<details data-menu="section">
										<summary aria-haspopup="true">Audio</summary>
										<div data-menu="links" role="group">
											<a href="/products/accessories/audio/headphones" role="menuitem">Headphones</a>
											<a href="/products/accessories/audio/earbuds" role="menuitem">Earbuds</a>
											<a href="/products/accessories/audio/speakers" role="menuitem">Speakers</a>
										</div>
									</details>
									
									<details data-menu="section">
										<summary aria-haspopup="true">Charging</summary>
										<div data-menu="links" role="group">
											<a href="/products/accessories/charging/cables" role="menuitem">Cables</a>
											<a href="/products/accessories/charging/wireless" role="menuitem">Wireless Chargers</a>
											<a href="/products/accessories/charging/power-banks" role="menuitem">Power Banks</a>
										</div>
									</details>
									
									<details data-menu="section">
										<summary aria-haspopup="true">Cases & Protection</summary>
										<div data-menu="links" role="group">
											<a href="/products/accessories/cases/phone-cases" role="menuitem">Phone Cases</a>
											<a href="/products/accessories/cases/laptop-bags" role="menuitem">Laptop Bags</a>
											<a href="/products/accessories/cases/screen-protectors" role="menuitem">Screen Protectors</a>
										</div>
									</details>
								</div>
							</details>
						</div>
					</details>
					
					<details data-menu="group" name="main-menu">
						<summary aria-haspopup="true">Services</summary>
						<div data-menu="panel" role="menu">
							<details data-menu="section">
								<summary aria-haspopup="true">Support</summary>
								<div data-menu="links" role="group">
									<a href="/services/support/technical" role="menuitem">Technical Support</a>
									<a href="/services/support/warranty" role="menuitem">Warranty</a>
									<a href="/services/support/repairs" role="menuitem">Repairs</a>
								</div>
							</details>
							
							<details data-menu="section">
								<summary aria-haspopup="true">Business</summary>
								<div data-menu="links" role="group">
									<a href="/services/business/enterprise" role="menuitem">Enterprise Solutions</a>
									<a href="/services/business/bulk-orders" role="menuitem">Bulk Orders</a>
									<a href="/services/business/consultation" role="menuitem">Consultation</a>
								</div>
							</details>
						</div>
					</details>
					
					<details data-menu="group" name="main-menu">
						<summary aria-haspopup="true">About</summary>
						<div data-menu="panel" role="menu">
							<a href="/about/company" role="menuitem">Company</a>
							<a href="/about/careers" role="menuitem">Careers</a>
							<a href="/about/news" role="menuitem">News</a>
							<a href="/about/contact" role="menuitem">Contact</a>
						</div>
					</details>
				</nav>

				<nav data-menu="secondary" role="menubar">
					<details data-menu="group" name="main-menu">
						<summary aria-haspopup="true">Search</summary>
						<search data-menu="panel">
							<input type="text" placeholder="Search..." role="searchbox">
							<button type="submit">Search</button>
						</search>
					</details>
					<a href="">Help</a>
				</nav>
			</div>
		</header>

		<!-- Main content -->

	<main>
		<h2>Welcome to Our Website</h2>
		<p>This is the main content area. Click on the menu items to explore more.</p>
	</main>
	<script>
		function setupMenuA11y(header, groupSel, panelSel, focusSel) {
			if (!header) return;
			let current = null;
			const clearAttrs = el => (el.removeAttribute('data-last-typed-char'), el.removeAttribute('data-last-typed-index'));
			const getElements = panel => Array.from(panel.querySelectorAll(focusSel)).filter(el => el.offsetParent);
			const closePanel = (details = current) => {
				if (details) {
					details.open = false;
					details.querySelector('summary')?.focus();
				}
			};
			const focusInPanel = (panel, isLast = false) => {
				const elements = getElements(panel);
				if (elements.length) {
					const target = isLast ? elements[elements.length - 1] : elements[0];
					setTimeout(() => target.focus(), 10);
				}
			};
			
			const handleKey = evt => {
				if (!current?.open) return;
				const panel = current.querySelector(panelSel);
				if (!panel) return;
				
				const elements = getElements(panel);
				const len = elements.length;
				
				if (evt.key === 'Escape' || evt.key === 'Tab') {
					closePanel();
					if (evt.key === 'Escape') evt.preventDefault();
					return;
				} else if ((evt.key === 'ArrowLeft' || evt.key === 'ArrowRight') && len) {
					evt.preventDefault();
					const idx = elements.indexOf(document.activeElement);
					const next = evt.key === 'ArrowRight' ? (idx + 1) % len : (idx - 1 + len) % len;
					elements[next].focus();
				} else if ((evt.key === 'Home' || evt.key === 'End') && len) {
					evt.preventDefault();
					elements[evt.key === 'Home' ? 0 : len - 1].focus();
				} else if (/^[a-z0-9]$/i.test(evt.key) && !evt.ctrlKey && !evt.altKey && !evt.metaKey) {
					evt.preventDefault();
					const char = evt.key.toLowerCase();
					const getText = el => (el.getAttribute('aria-label') || el.textContent || el.innerText || el.value || el.placeholder || '').trim().toLowerCase();
					const matches = elements.filter(el => getText(el).startsWith(char));
					
					if (!matches.length) return;
					
					const {lastTypedChar: last, lastTypedIndex: lastIdx} = current.dataset;
					const nextIdx = last === char ? ((+lastIdx || 0) + 1) % matches.length : 0;
					
					matches[nextIdx].focus();
					current.dataset.lastTypedChar = char;
					current.dataset.lastTypedIndex = nextIdx;
				}
			};
			
			const handleClick = evt => current && !header.contains(evt.target) && closePanel();
			
			const handleMenubarKey = evt => {
				if (evt.target.tagName !== 'SUMMARY' || !evt.target.closest(groupSel)) return;
				if (evt.key === 'ArrowDown' || evt.key === 'ArrowUp') {
					evt.preventDefault();
					const details = evt.target.closest(groupSel);
					details.open = true;
					const panel = details.querySelector(panelSel);
					panel && setTimeout(() => focusInPanel(panel, evt.key === 'ArrowUp'), 10);
				}
			};
			
			header.addEventListener('keydown', handleMenubarKey);
			
			header.addEventListener('toggle', evt => {
				const details = evt.target;
				if (!details.matches(groupSel)) return;
				
				if (details.open) {
					header.querySelectorAll(groupSel).forEach(other => other !== details && other.open && (other.open = false, clearAttrs(other)));
					current = details;
					clearAttrs(current);
					document.addEventListener('keydown', handleKey, true);
					document.addEventListener('click', handleClick, true);
					
					const panel = details.querySelector(panelSel);
					panel && focusInPanel(panel);
				} else if (current === details) {
					document.removeEventListener('keydown', handleKey, true);
					document.removeEventListener('click', handleClick, true);
					clearAttrs(details);
					current = null;
				}
			}, true);
		}
		
		document.addEventListener('DOMContentLoaded', () => {
			setupMenuA11y(
				document.querySelector('[data-menu="header"]'),
				'nav[data-menu="primary"] > details[data-menu="group"], nav[data-menu="secondary"] > details[data-menu="group"]',
				'[data-menu="panel"]',
				'a[href]:not([disabled]), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
			);
		});
	</script>
</body>
</html>