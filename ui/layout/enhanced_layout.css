@layer layout {
	lay-out {
		--_xxs: attr(xxs type(<number>), 1);
		--_xs:  attr(xs type(<number>));
		--_sm:  attr(sm type(<number>));
		--_md:  attr(md type(<number>));
		--_lg:  attr(lg type(<number>));
		--_xl:  attr(xl type(<number>));
		--_xxl: attr(xxl type(<number>));

		--_cg: attr(col-gap type(<length> | <percentage>), 0);
		--_rg: attr(row-gap type(<length> | <percentage>), var(--_cg));
		--_sz: attr(size type(<length> | <custom-ident>), auto);

		/* Enhanced: Support for layout attribute per breakpoint */
		--_xs-layout:  attr(xs-layout type(<custom-ident>), "");
		--_sm-layout:  attr(sm-layout type(<custom-ident>), "");
		--_md-layout:  attr(md-layout type(<custom-ident>), "");
		--_lg-layout:  attr(lg-layout type(<custom-ident>), "");
		--_xl-layout:  attr(xl-layout type(<custom-ident>), "");
		--_xxl-layout: attr(xxl-layout type(<custom-ident>), "");

		column-gap: var(--_cg);
		contain: layout inline-size;
		container-type: inline-size;
		contain-intrinsic-size: var(--_sz);
		display: grid;
		grid-auto-flow: row dense;
		grid-template-columns: repeat(var(--layout-gtc, 1), 1fr);
		grid-template-rows: var(--layout-gtr, auto);
		row-gap: var(--_rg);

		& > * { grid-area: var(--layout-ga, auto); }

		/* RESPONSIVE BREAKPOINTS */

		/* Extra Small: 240px+ */
		@container (min-width: 240px) {
			--layout-gtc: var(--_xs, var(--_xxs));
		}

		/* Small: 380px+ */
		@container (min-width: 380px) {
			--layout-gtc: var(--_sm, var(--_xs, var(--_xxs)));
			
			/* Enhanced: Check both name and sm-layout attributes */
			&[name*="sm:"],
			&[sm-layout] {
				/* Basic layouts */
				&[name*="sm:equal"] { --layout-gtc: var(--_sm); }
				&[sm-layout="equal"] { --layout-gtc: var(--_sm); }
			}
		}

		/* Medium: 540px+ */
		@container (min-width: 540px) {
			--layout-gtc: var(--_md, var(--_sm, var(--_xs, var(--_xxs))));

			/* Original name-based layouts */
			&[name*="md:50-50-100"],
			&[name*="md:100-50-50"] { --layout-gtc: 2; }
			&[name*="md:33-66"],
			&[name*="md:66-33"] { --layout-gtc: 3; }
			&[name*="md:25-75"],
			&[name*="md:75-25"] { --layout-gtc: 4; }

			/* Enhanced: Attribute-based layouts */
			&[md-layout="50-50-100"],
			&[md-layout="100-50-50"] { --layout-gtc: 2; }
			&[md-layout="33-66"],
			&[md-layout="66-33"] { --layout-gtc: 3; }
			&[md-layout="25-75"],
			&[md-layout="75-25"] { --layout-gtc: 4; }

			/* Grid area assignments for percentage layouts */
			&[name*="md:66-33"] *:nth-of-type(2n+1),
			&[md-layout="66-33"] *:nth-of-type(2n+1),
			&[name*="md:33-66"] *:nth-of-type(2n+2),
			&[md-layout="33-66"] *:nth-of-type(2n+2) { --layout-ga: auto / span 2; }

			&[name*="md:25-75"] *:nth-of-type(2n+2),
			&[md-layout="25-75"] *:nth-of-type(2n+2),
			&[name*="md:75-25"] *:nth-of-type(2n+1),
			&[md-layout="75-25"] *:nth-of-type(2n+1) { --layout-ga: auto / span 3; }

			/* Asymmetric layouts */
			&[name*="md:asym-lr"],
			&[md-layout="asym-lr"] {
				--layout-gtc: 8;
				*:nth-of-type(2n+1) { --layout-ga: 1 / 1 / 7 / 7; }
				*:nth-of-type(2n+2) { --layout-ga: 3 / 5 / 5 / 9; }
			}

			&[name*="md:asym-rl"],
			&[md-layout="asym-rl"] {
				--layout-gtc: 8;
				*:nth-of-type(2n+1) { --layout-ga: 1 / 3 / 7 / 9; }
				*:nth-of-type(2n+2) { --layout-ga: 3 / 1 / 5 / 5; }
			}

			/* Sidebar layouts */
			&[name*="md:sidebar-left"],
			&[md-layout="sidebar-left"] {
				--layout-gtc: 4;
				*:nth-of-type(2n+1) { --layout-ga: auto / span 1; }
				*:nth-of-type(2n+2) { --layout-ga: auto / span 3; }
			}

			&[name*="md:sidebar-right"],
			&[md-layout="sidebar-right"] {
				--layout-gtc: 4;
				*:nth-of-type(2n+1) { --layout-ga: auto / span 3; }
				*:nth-of-type(2n+2) { --layout-ga: auto / span 1; }
			}
		}

		/* Large: 720px+ */
		@container (min-width: 720px) {
			--layout-gtc: var(--_lg, var(--_md, var(--_sm, var(--_xs, var(--_xxs)))));

			/* Enhanced layouts for large screens */
			&[name*="lg:thirds"],
			&[lg-layout="thirds"] { 
				--layout-gtc: 3; 
				& > * { --layout-ga: auto / span 1; }
			}

			&[name*="lg:quarters"],
			&[lg-layout="quarters"] { 
				--layout-gtc: 4; 
				& > * { --layout-ga: auto / span 1; }
			}

			&[name*="lg:hero-grid"],
			&[lg-layout="hero-grid"] {
				--layout-gtc: 4;
				*:nth-of-type(1) { --layout-ga: 1 / 1 / 3 / 3; }
				*:nth-of-type(2) { --layout-ga: 1 / 3 / 2 / 5; }
				*:nth-of-type(3) { --layout-ga: 2 / 3 / 3 / 4; }
				*:nth-of-type(4) { --layout-ga: 2 / 4 / 3 / 5; }
			}
		}

		/* Extra Large: 920px+ */
		@container (min-width: 920px) {
			--layout-gtc: var(--_xl, var(--_lg, var(--_md, var(--_sm, var(--_xs, var(--_xxs))))));

			&[name*="xl:magazine"],
			&[xl-layout="magazine"] {
				--layout-gtc: 6;
				*:nth-of-type(1) { --layout-ga: 1 / 1 / 3 / 4; }
				*:nth-of-type(2) { --layout-ga: 1 / 4 / 2 / 7; }
				*:nth-of-type(3) { --layout-ga: 2 / 4 / 3 / 6; }
				*:nth-of-type(4) { --layout-ga: 2 / 6 / 3 / 7; }
			}
		}

		/* Extra Extra Large: 1140px+ */
		@container (min-width: 1140px) {
			--layout-gtc: var(--_xxl, var(--_xl, var(--_lg, var(--_md, var(--_sm, var(--_xs, var(--_xxs)))))));

			&[name*="xxl:dashboard"],
			&[xxl-layout="dashboard"] {
				--layout-gtc: 12;
				*:nth-of-type(1) { --layout-ga: 1 / 1 / 2 / 13; } /* Header */
				*:nth-of-type(2) { --layout-ga: 2 / 1 / 6 / 4; }  /* Sidebar */
				*:nth-of-type(3) { --layout-ga: 2 / 4 / 6 / 13; } /* Main content */
			}
		}
	}
}